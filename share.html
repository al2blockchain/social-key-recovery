<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Secrets</title>
</head>
<body>
    <h1 id="shareSecrets"></h1>
    <p id="shareSecretsDesc"></p>
    <form class="form-inline">
        <label for="secret" id="secretLabel"></label>
        <input type="text" id="secret" name="secret" required>

        <label for="friends" id="friends"></label>
        <input type="number" id="friends" name="friends" size="1" required>

        <label for="requiredFriends" id="requiredFriends"></label>
        <input type="number" id="requiredFriends" name="requiredFriends" size="1" required>

        <button id="submit" type="submit"></button>
    </form>
    <ol id="shares"></ol>
    <a id="reveal" href="reveal.html"></a>
    <a id="home" href="index.html"></a>
    
    <script src="secrets.js"></script>
    <script src="i18n.js"></script>
</body>
<script>
    // i18n
    document.title = i18n.title;
    document.getElementById("shareSecrets").innerHTML = i18n.shareSecrets;
    document.getElementById("shareSecretsDesc").innerHTML = i18n.shareSecretsDesc;
    document.getElementById("secretLabel").innerHTML = i18n.secretLabel;
    document.getElementById("friends").innerHTML = i18n.friends;
    document.getElementById("requiredFriends").innerHTML = i18n.requiredFriends;
    document.getElementById("reveal").innerHTML = i18n.reveal;
    document.getElementById("home").innerHTML = i18n.home;
    document.getElementById("submit").innerHTML = i18n.share;
    // init the secrets library
    secrets.init();
    // get the form
    const form = document.forms[0];
    // listen for submit
    form.addEventListener("submit", function(event) {
        event.preventDefault();
        new FormData(form);
    });
    // listen for form data
    form.addEventListener("formdata", event => {
        const data = event.formData;
        const values = [...data.values()];
        // get secret
        const secret = values[0];
        try {
            // get friends
            const friends = parseInt(values[1]);
            // get requiredFriends
            const requiredFriends = parseInt(values[2]);
            try {
                const shares = secrets.share(secret, friends, requiredFriends);            
                document.getElementById("shares").innerHTML = shares
                    .map(share => `<li>${share}</li>`).toString().replace(/,/g, '');                
            } catch (error) {
                alert(error.message);
            }
        } catch (error) {
            alert(error.message);
        }        
    });
</script>
</html>